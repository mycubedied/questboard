<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <title>Quest Board</title>
    <script type="module" src="/main.js"></script>
    <style>
        body {
            transition: background 0.3s;
        }
        .quest-board-header {
            background: linear-gradient(135deg, #B2EBFF 0%, #FFD8EA 100%);
            color: #333;
            padding: 20px;
            text-align: center;
            box-shadow: 0 2px 10px rgba(0,0,0,0.12);
        }
        .quest-board-container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }

        .quest-card {
            background: white;
            border-radius: 8px;
            padding: 20px;
            margin: 15px 0;
            box-shadow: 0 2px 8px rgba(0,0,0,0.08);
            transition: transform 0.2s;
        }

        .quest-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
        }

        .quest-title {
            font-size: 20px;
            font-weight: bold;
            color: #333;
            margin-bottom: 10px;
        }

        .quest-description {
            color: #666;
            margin-bottom: 10px;
        }

        .quest-status {
            display: inline-block;
            padding: 5px 15px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: bold;
        }

        .quest-status.active { background: #4caf50; color: white; }
        .quest-status.pending { background: #ff9800; color: white; }
        .quest-status.completed { background: #2196f3; color: white; }

        .quest-category {
            display: inline-block;
            padding: 3px 10px;
            border-radius: 15px;
            font-size: 11px;
            font-weight: bold;
            margin-right: 10px;
            text-transform: uppercase;
        }

        .category-cardio { background: #e3f2fd; color: #1976d2; }
        .category-strength { background: #fce4ec; color: #c2185b; }
        .category-flexibility { background: #f3e5f5; color: #7b1fa2; }
        .category-wellness { background: #e8f5e9; color: #388e3c; }
        .category-custom { background: #eceff1; color: #37474f; }

        .complete-btn {
            background: #4caf50;
            color: white;
            border: none;
            padding: 8px 20px;
            border-radius: 5px;
            cursor: pointer;
            font-weight: bold;
            margin-top: 10px;
            transition: background 0.3s;
        }
        .complete-btn:hover { background: #45a049; }
        .complete-btn:disabled { background: #cccccc; cursor: not-allowed; }

        .start-btn {
            background: #2196f3;
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 5px;
            cursor: pointer;
            font-weight: bold;
            margin-top: 10px;
            margin-left: 10px;
            transition: background 0.3s;
        }
        .start-btn:hover { background: #1976d2; }

        .delete-btn {
            background: #f44336;
            color: white;
            border: none;
            padding: 8px 12px;
            border-radius: 6px;
            cursor: pointer;
            font-weight: bold;
            margin-left: 8px;
        }
        .delete-btn:hover { background: #d32f2f; }

        .refresh-btn {
            background: #AB47BC;
            color: white;
            border: none;
            padding: 10px 25px;
            border-radius: 5px;
            cursor: pointer;
            font-weight: bold;
            margin-bottom: 20px;
            font-size: 16px;
        }
        .refresh-btn:hover { background: #7B1FA2; }

        .coin-display {
            background: #ffd700;
            color: #333;
            padding: 8px 20px;
            border-radius: 20px;
            font-weight: bold;
            font-size: 18px;
            display: inline-flex;
            align-items: center;
            gap: 5px;
        }

        .shop-btn {
            background: #ff9800;
            color: white;
            border: none;
            padding: 10px 25px;
            border-radius: 5px;
            cursor: pointer;
            font-weight: bold;
            font-size: 16px;
            margin-left: 10px;
        }
        .shop-btn:hover { background: #f57c00; }

        .terms-btn {
            background: #607d8b;
            color: white;
            border: none;
            padding: 8px 14px;
            border-radius: 6px;
            cursor: pointer;
            font-weight: bold;
            margin-left: 8px;
            font-size: 14px;
        }
        .terms-btn:hover { background: #546e7a; }

        /* Brighter profile strip */
        .user-profile-details-style {
            background: linear-gradient(90deg,#F7FFDB 0%, #D1FFD0 100%) !important;
            transition: background 0.3s;
        }

        /* ...rest of your CSS remains unchanged... */
    </style>
</head>
<body style="background:linear-gradient(135deg,#E2FFFC 0%,#FFF5FB 100%)">

<!-- ... rest of your HTML (unchanged) ... -->

<script>
    // ------------ Brighter Background for Entire Page ------------
    document.body.style.background = "linear-gradient(135deg,#E2FFFC 0%,#FFF5FB 100%)";
    // Profile strip brighter variant:
    function setProfileStripBright() {
        var profileStrip = document.querySelector('.user-profile-details-style');
        if(profileStrip) {
            profileStrip.style.background = "linear-gradient(90deg,#F7FFDB 0%, #D1FFD0 100%)";
        }
    }

    // ------------ Shuffling Quests Feature ------------
    // Fisher-Yates shuffle utility
    function shuffleArray(array) {
        for (let i = array.length - 1; i > 0; i--) {
            const j = Math.floor(Math.random() * (i + 1));
            [array[i], array[j]] = [array[j], array[i]];
        }
        return array;
    }

    let allQuests = []; // Store the currently loaded main quests (not custom)
    let currentQuests = []; // What is currently rendered

    // Overwrite to store unshuffled for shuffling
    window.questBoardAPI = window.questBoardAPI || {};
    window.questBoardAPI.generateRandomQuests = function(count = 6, category = 'all') {
        const sample = [
            { title: "30-Minute Walk", description: "A brisk walk for 30 minutes.", category: "cardio", status: "active" },
            { title: "Push-up Set", description: "Do 3 sets of 10 push-ups.", category: "strength", status: "active" },
            { title: "Stretch Routine", description: "10 minutes of full-body stretching.", category: "flexibility", status: "active" },
            { title: "Mindful Breathing", description: "5 minutes of breathing exercises.", category: "wellness", status: "active" },
            { title: "Short Run", description: "Run for 15-20 minutes at an easy pace.", category: "cardio", status: "active" },
            { title: "Core Workout", description: "Plank + bicycle crunches for core.", category: "strength", status: "active" }
        ];
        let pool = sample.slice();
        if (category !== 'all') pool = pool.filter(q => q.category === category);
        while (pool.length < count) pool = pool.concat(sample);
        let out = [];
        for (let i = 0; i < count; i++) {
            const src = pool[i % pool.length];
            out.push({
                quest_id: Date.now() + i + Math.floor(Math.random() * 1000),
                title: src.title,
                description: src.description,
                category: src.category,
                status: src.status,
                custom: false
            });
        }
        allQuests = out.slice(); // <- Save to main data
        return out;
    };

    // ------------- Load and Re-render Quests -------------
    function loadQuests(opts) {
        setProfileStripBright();
        const questList = document.getElementById('quest-list');
        questList.innerHTML = '<p style="text-align:center;color:#666">Loading quests...</p>';
        const filter = document.getElementById('quest-filter') ? document.getElementById('quest-filter').value : 'all';
        let mainQuests;
        if (!allQuests.length || opts && opts.newSet) {
            mainQuests = window.questBoardAPI.generateRandomQuests(6, filter === 'all' ? 'all' : filter);
        } else {
            mainQuests = allQuests.slice();
        }
        // Incorporate custom quests
        const customQuests = (window.loadCustomQuestsFromStorage ? window.loadCustomQuestsFromStorage() : []);
        let questsToShow;
        if (filter === 'custom') questsToShow = customQuests.slice();
        else if (filter === 'all') questsToShow = mainQuests.concat(customQuests);
        else questsToShow = mainQuests.filter(q => q.category === filter);
        if (opts && opts.shuffle && filter !== "custom") questsToShow = shuffleArray(questsToShow);

        currentQuests = questsToShow;
        questList.innerHTML = '';
        if (questsToShow.length === 0) {
            questList.innerHTML = '<p style="text-align:center;color:#666">No quests available for the selected category.</p>'; 
            return;
        }
        questsToShow.forEach(quest => {
            const questCard = document.createElement('div');
            questCard.className = 'quest-card';
            questCard.setAttribute('data-quest-id', quest.quest_id);
            if (quest.category === 'custom') questCard.setAttribute('data-custom','true');
            const isCompleted = localStorage.getItem('quest_' + quest.quest_id) === 'completed';
            questCard.innerHTML = `
                <div>
                    <span class="quest-category category-${quest.category}">${quest.category}</span>
                    <span class="quest-status ${isCompleted ? 'completed' : quest.status}">
                        ${isCompleted ? 'COMPLETED' : quest.status.toUpperCase()}
                    </span>
                </div>
                <div class="quest-title">${escapeHtml(quest.title)}</div>
                <div class="quest-description">${escapeHtml(quest.description)}</div>
                ${
                    quest.category === 'custom'
                        ? `<button class="delete-btn" onclick="deleteCustomQuest('${quest.quest_id}')">Delete</button>`
                        : ''
                }
                ${
                    !isCompleted
                        ? `<button class="complete-btn" onclick="markQuestComplete('${quest.quest_id}')">Mark Complete</button>`
                        : ''
                }
            `;
            questList.appendChild(questCard);
        });
    }

    // --------- Shuffle when get new quests pressed ---------
    document.addEventListener("DOMContentLoaded", function() {
        // Brighter backgrounds on load
        document.body.style.background = "linear-gradient(135deg,#E2FFFC 0%,#FFF5FB 100%)";
        setProfileStripBright();

        // Set up the 'Get New Quests' button
        var refreshBtn = document.getElementById("refresh-quests");
        if (refreshBtn) {
            refreshBtn.addEventListener("click", function() {
                // New shuffle, re-pick main quests
                loadQuests({shuffle:true, newSet:true});
            });
        }
    });

    // Utilities:
    function escapeHtml(str) {
        return String(str)
            .replace(/&/g, "&amp;")
            .replace(/"/g, "&quot;")
            .replace(/'/g, "&#39;")
            .replace(/</g, "&lt;")
            .replace(/>/g, "&gt;");
    }
    // Dummy complete (use your original for coin reward update):
    function markQuestComplete(questId) {
        localStorage.setItem('quest_' + questId, 'completed');
        loadQuests();
    }
    window.markQuestComplete = markQuestComplete;
    // Dummy delete (provide your original):
    function deleteCustomQuest(questId) {
        if (!confirm('Delete this custom quest? This cannot be undone.')) return;
        // Example: update as appropriate
        loadQuests();
    }
    window.deleteCustomQuest = deleteCustomQuest;

    // First load
    window.addEventListener('DOMContentLoaded', function() {
        loadQuests();
    });
</script>
</body>
</html>
